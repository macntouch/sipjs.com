<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <title>Make a call | SIP.js</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/shared/js/documentation.js" type="text/javascript"></script>
</head>


<body class="guides">
  <div id="header-wrapper">
  <div id="header">
    <div>
      <a class="logo" href="/">SIP.js</a>
      <ul class="nav">
        <li><a href="/download/" class="nav-download">Download</a></li>
        <li><a href="/api/" class="nav-api">API</a></li>
        <li><a href="/guides/" class="nav-guides">Guides</a></li>
        <li><a href="https://github.com/onsip/sip.js">Github</a></li>
        <li><a href="/aboutus/" class="nav-aboutus">About Us</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/sip_js">Support</a></li>
      </ul>
    </div>
  </div><!-- #header -->
</div><!-- #header-wrapper -->


  <div class="sub-nav">
    <h2>Guides</h2>
    <ul>
      <li><a href="/guides/" class="active">Guides</a></li>
    </ul>
  </div>

  <div id="wrapper">
    <div class="content">
      <h1 id="make-a-call">Make a Call</h1>

<ul id="markdown-toc">
<li><a href="#overview">Overview</a></li>
</ul><p>Let’s walk through core API concepts as we tackle some everyday use cases.</p>

<h2 id="overview">Overview</h2>

<h3 id="setup-and-video-elements">Setup and Video Elements</h3>

<p>First we must create the files index.html, main.js, and style.css in the same folder.  In the index.html file we need to include the SIP.js library, which can be downloaded <a href="/download/">here</a>, as well as the main.js file.  </p>

<p>In order to make a video call, we need a way to display the video call on your screen.  We can use a <code>&lt;video&gt;</code> element for this.  The <code>&lt;video&gt;</code> adds a standard way for browsers to display video over the internet without additional plugins. This makes <code>&lt;video&gt;</code> perfect for WebRTC. The local video stream should always be muted to prevent feedback.</p>

<p>In this example, within the <code>&lt;body&gt;</code> tags, we have a <code>remoteVideo</code> <code>&lt;video&gt;</code>, to display the video of the person you are calling.  We also have a <code>localVideo</code> <code>&lt;video&gt;</code>, to display the video stream that you are sending to the person you are calling.  </p>

<p>Although we are loading the SIP.js library, we are not doing anything with it yet.</p>

<p>In the style.css file we will put a border around the <code>&lt;video&gt;</code> elements, to visualize them better.</p>

<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/mgc2e/11/embedded/html,js,css,result/">
</iframe>

<h3 id="making-the-call">Making the Call</h3>

<p>These video elements are not useful if we aren’t calling anyone, so lets make a call.  </p>

<h4 id="creating-the-user-agent">Creating the User Agent</h4>

<p>In order to make calls and send messages you must create a SIP user agent.  For this example, we will create an anonymous user agent.  To do this we will call the <code>SIP.UA()</code> method and then we must start the user agent. After starting the user agent we will catch the <code>connected</code> event, which will fire when the user agent is created.</p>

<iframe style="width: 100%; height: 410px" src="http://jsfiddle.net/4m7dc/11/embedded/js,html,css,result/">
</iframe>

<h4 id="sending-the-invite">Sending the Invite</h4>

<p>After the user agent has connected to the SIP server (which is a public Google server by default) we can send an invite to make a call.  We must first catch the <code>connected</code> SIP event, to ensure that the user agent has been created and has connected.  Once the connected event has happened, our example calls the <code>onConnected()</code> method.  This method then creates a SIP session by sending an invite.  </p>

<p>To send an invite we must first create a javascript object, which contains the <code>mediaConstraints</code> variable in which we specify whether the session contains audio and video (i.e. whether it is a video call or an audio call).  </p>

<p>We must then call the <code>.invite()</code> method, along with the address that we are sending the invite to and the <code>options</code> media constraint javascript object.</p>

<p>When we make the call the browser will ask for permission to access the camera and microphone.  We must allow this in order to make the call.  Once we send the invite the other party has the choice of either accepting or rejecting the call.  </p>

<p>We will also add an <code>endCall</code> button, which terminates the session using the <code>.bye()</code> method.</p>

<iframe style="width: 100%; height: 410px" src="http://jsfiddle.net/T4Kv2/16/embedded/js,html,css,result/">
</iframe>

<h3 id="displaying-the-call">Displaying the Call</h3>

<p>Although we are now able to make calls, we are not yet displaying the videos on the screen.  To do this we need to attach the video streams that we are sending and receiving to the video elements that we added in the beginning.  </p>

<p>We cannot just immediately attach the media streams; we must first wait until the call begins.  To do this we need to catch the <code>accepted</code> SIP event and attach the media streams after this point.  </p>

<p>We have created a new function called onAccepted(), which it runs as soon as the call connects.  This function calls the <code>attachMediaStream</code> function on both media streams, and then plays both video elements.</p>

<p>The function <code>attachMediaStream</code> attaches the media stream to the video element.</p>

<iframe style="width: 100%; height: 600px" src="http://jsfiddle.net/qWmG7/20/embedded/js,html,css,result/">
</iframe>
    </div>

    <div id="js-sidebar" class="sidebar-shell">
      <div class="sidebar-module">
          <ul>
            <li><h3><a href="/guides/">Overview</a></h3></li>
            <li><h3><a href="/guides/convert-to-sipjs/">Convert to SIP.js</a></h3></li>
            <li><h3><a href="/guides/make-call/">Make a Call</a></h3></li>
            <li><h3><a href="/guides/receive-call/">Receive a Call</a></h3></li>
            <li><h3><a href="/guides/send-dtmf/">Send Dtmf</a></h3></li>
            <li><h3><a href="/guides/send-message/">Send Message</a></h3></li>
          </ul>
      </div>
    </div>
  </div><!-- #wrapper -->

  <div id="footer" >
  <div class="lower_footer">
    <ul class="footer-cell">
      <li><a href="https://groups.google.com/forum/#!forum/sip_js">Mailing List</a></li>				
      <li><a href="https://github.com/onsip/sip.js/issues">Report Issues</a></li>		
      <li><a href="/license/">License</a></li>
    </ul>

    <span class="footer-cell">
      <a href="https://www.onsip.com" class="mega-icon mega-icon-invertocat"></a>
    </span>

    <ul class="footer-cell">
      <li><a href="https://onsip.com/blog">Blog</a></li>
      <li><a href="/aboutus/">About</a></li>
    </ul>
  </div>
  
  <div class="wrapper">
  </div>

</div><!-- /#footer -->

<script src="/shared/js/retina.js" type="text/javascript"></script>

</body>
</html>
