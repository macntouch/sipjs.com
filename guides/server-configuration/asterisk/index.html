<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <meta name="description" content="Easily install & configure Asterisk to work with SIP.js" />
  <title>Asterisk Installation & Configuration | SIP.js</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href='http://fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round' rel='stylesheet' type='text/css'>
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/shared/js/documentation.js" type="text/javascript"></script>

  <link rel="shortcut icon" type="image/x-icon" href="/shared/img/favicon-6.ico"/>
</head>


<body class="guides">
  <div id="dev"></div>
<header id="siteHeader">
  <div class="wrapper">
    <a href="/"><img id="logo" src="/shared/img/logo.png" alt="sip.js"></a>
    <nav id="mainNav">
      <ul class="horizontal">
        <li><a href="/download/">Download</a></li>
        <li><a href="/api/0.6.0/">API</a></li>
        <li><a href="/guides/">Guides</a></li>
        <li><a href="https://github.com/onsip/sip.js" target="_blank">Github</a></li>
        <li><a href="/aboutus/" class="nav-aboutus">About Us</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Support</a></li>
      <ul>
    </nav>
  </div>
</header>


  <article id="main" class="wrapper group">
    <header id="sectionHeader">
      <h1><a href="/guides/">Guides</a></h1>
    </header>
    <div id="content">
      <h1 id="configure-asterisk">Configure Asterisk</h1>

<p>SIP.js has been tested with <a href="http://downloads.asterisk.org/pub/telephony/asterisk/releases/asterisk-11.9.0.tar.gz">Asterisk 11.9.0</a> without any modification to the source code of SIP.js or Asterisk. Similar configuration should also work for Asterisk 12.</p>

<h2 id="system-setup">System Setup</h2>

<p>Asterisk and SIP.js were tested using the following setup:</p>

<ul>
  <li><a href="http://isoredirect.centos.org/centos/6/isos/x86_64/">CentOS 6.5 minimal (x86_64)</a></li>
  <li><a href="http://downloads.asterisk.org/pub/telephony/asterisk/releases/asterisk-11.9.0.tar.gz">Asterisk 11.9.0</a></li>
  <li><a href="http://srtp.sourceforge.net/srtp-1.4.2.tgz">libsrtp 1.4.2</a></li>
  <li>A public IP address to avoid NAT scenarios on the server side.</li>
</ul>

<h2 id="required-packages">Required Packages</h2>

<p>Install the following dependencies:</p>

<ul>
  <li>wget</li>
  <li>gcc</li>
  <li>gcc-c++</li>
  <li>ncurses-devel</li>
  <li>libxml2-devel</li>
  <li>sqlite3-devel</li>
  <li>libsrtp-devel</li>
  <li>libuuid-devel</li>
</ul>

<p>Using YUM, all dependencies can be installed with:</p>

<p><code>yum install wget gcc gcc-c++ ncurses-devel libxml2-devel sqlite3-devel libsrtp-devel libuuid-devel</code>.</p>

<h2 id="install-libsrtp">Install libsrtp</h2>

<p>By default, libsrtp is not included in the Asterisk yum repository. Installing it from source is not difficult.</p>

<ol>
  <li><code>cd /usr/src/</code></li>
  <li><code>wget http://srtp.sourceforge.net/srtp-1.4.2.tgz</code></li>
  <li><code>tar zxvf srtp-1.4.2.tgz</code></li>
  <li><code>cd /usr/src/srtp</code></li>
  <li><code>./configure CFLAGS=-fPIC</code></li>
  <li><code>make &amp;&amp; make install</code></li>
</ol>

<h2 id="install-asterisk">Install Asterisk</h2>

<ol>
  <li><code>cd /usr/src/</code></li>
  <li>Downlaod Asterisk with <code>wget http://downloads.asterisk.org/pub/telephony/asterisk/releases/asterisk-11.9.0.tar.gz</code>.</li>
  <li>Extract Asterisk: <code>tar zxvf asterisk*</code>.</li>
  <li>Enter the Asterisk directory: <code>cd /usr/src/asterisk*</code>.</li>
  <li>Run the Asterisk configure script: <code>./configure --libdir=/usr/lib64</code>.</li>
  <li>Run the Asterisk menuselect tool: <code>make menuselect</code>.</li>
  <li>In the menuselect, go to the resources option and ensure that res_srtp is enabled. If there are 3 x’s next to res_srtp, there is a problem with the srtp library and you must reinstall it. Save the configuration (press x).</li>
  <li>Compile and install Asterisk: <code>make &amp;&amp; make install</code>.</li>
  <li>If you need the sample configs you can run <code>make samples</code> to install the sample configs. If you need to install the Asterisk startup script you can run <code>make config</code>.</li>
</ol>

<h2 id="configure-asterisk-for-webrtc">Configure Asterisk For WebRTC</h2>

<p>For WebRTC, a lot of the settings that are needed MUST be in the <strong>peer settings</strong>. The global settings do not flow down into the peer settings very well.
By default, Asterisk config files are located in <code>/etc/asterisk/</code>.
Start by editing <code>http.conf</code> and make sure that the following lines are uncommented:</p>

<div>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>;http.conf
[general]
enabled=yes
bindaddr=127.0.0.1 ; Replace this with your IP address
bindport=8088 ; Replace this with the port you want to listen on
</pre></td>
</tr></table>
</div>

<p>Change the IP address and port to the IP address of your server and the port that you would like Asterisk to listen for web socket connections on.</p>

<p>Next, edit <code>sip.conf</code>. Here you will set up two peers, one for a WebRTC client and one for a non-WebRTC SIP client. The WebRTC peer requires encryption, avpf, and icesupport to be enabled. In most cases, directmedia should be disabled. Also under the WebRTC client, the transport needs to be listed as ‘ws’ to allow websocket connections. All of these config lines should be under the peer itself; setting these config lines globally might not work.</p>

<div>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td>
  <td class="code"><pre>;sip.conf
[general]
realm=127.0.0.1 ; Replace this with your IP address
udpbindaddr=127.0.0.1 ; Replace this with your IP address
transport=udp

[1060] ; This will be WebRTC client
type=friend
username=1060 ; The Auth user for SIP.js
host=dynamic ; Allows any host to register
secret=password ; The SIP Password for SIP.js
encryption=yes ; Tell Asterisk to use encryption for this peer
avpf=yes ; Tell Asterisk to use AVPF for this peer
icesupport=yes ; Tell Asterisk to use ICE for this peer
context=default ; Tell Asterisk which context to use when this peer is dialing
directmedia=no ; Asterisk will relay media for this peer
transport=udp,ws ; Asterisk will allow this peer to register on UDP or WebSockets

[1061] ; This will be the legacy SIP client
type=friend
username=1061
host=dynamic
secret=password
context=default
</pre></td>
</tr></table>
</div>

<p>Lastly, set up <code>extensions.conf</code> to allow the two peers to call each other.</p>

<div>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>;extensions.conf
[default]
exten =&gt; 1060,1,Dial(SIP/1060) ; Dialing 1060 will call the SIP client registered to 1060
exten =&gt; 1061,1,Dial(SIP/1061) ; Dialing 1061 will call the SIP client registered to 1061
</pre></td>
</tr></table>
</div>

<p>Restart Asterisk using <code>service asterisk restart</code> to ensure that the new settings take effect.</p>

<h2 id="configure-sipjs">Configure SIP.js</h2>

<p>Asterisk does not accept Contact headers with the <code>.invalid</code> domain. When creating a UA, add the configuration parameter <a href="http://sipjs.com/api/0.6.0/ua_configuration_parameters/#hackipincontact">hackIpInContact</a>. If you are missing this property you will be able to make calls from WebRTC, but not receive calls through Asterisk will fail.</p>

<p>The following configuration example creates a UA for the Asterisk configuration above. Replace the values with the values from your config.</p>

<div>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> config = {
  <span class="comment">// Replace this IP address with your Asterisk IP address</span>
  <span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">1060@127.0.0.1</span><span class="delimiter">'</span></span>,

  <span class="comment">// Replace this IP address with your Asterisk IP address,</span>
  <span class="comment">// and replace the port with your Asterisk port from the http.conf file</span>
  <span class="key">ws_servers</span>: <span class="string"><span class="delimiter">'</span><span class="content">ws://127.0.0.1:8088/ws</span><span class="delimiter">'</span></span>,

  <span class="comment">// Replace this with the username from your sip.conf file</span>
  <span class="key">authorizationUser</span>: <span class="string"><span class="delimiter">'</span><span class="content">1060</span><span class="delimiter">'</span></span>,

  <span class="comment">// Replace this with the password from your sip.conf file</span>
  <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>,

  <span class="comment">// This is required to route requests through Asterisk</span>
  <span class="key">hackIpInContact</span>: <span class="predefined-constant">true</span>
};

<span class="keyword">var</span> ua = <span class="keyword">new</span> SIP.UA(config);
</pre></td>
</tr></table>
</div>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>This <a href="http://forums.digium.com/viewtopic.php?f=1&amp;t=90167&amp;sid=66fdf8cc4be5d955ba584e989a23442f">forum post</a> on troubleshooting WebRTC issues is a great guide for trouble shooting problems with Asterisk.</p>

    </div>

    <nav id="sideNav">
  <ul>
    <li><a href="/guides/">Overview</a></li>
    <li class="parent">
      <a class="parent" href="/guides/server-configuration/">Server Configuration</a>
      <ul>
        <li><a href="/guides/server-configuration/freeswitch/">FreeSWITCH</a></li>
        <li><a href="/guides/server-configuration/asterisk/">Asterisk</a></li>
        <li><a href="/guides/server-configuration/onsip-network/">OnSIP Network</a></li>
      </ul>
    </li>
    <li class="parent">
      <a class="parent" href="/guides/mobile/">Mobile</a>
      <ul>
        <li><a href="/guides/mobile/android-native/">Android (Native)</a></li>
      </ul>
    </li>
    <li><a href="/guides/convert-to-sipjs/">Convert to SIP.js</a></li>
    <li><a href="/guides/user-agent-construction/">User Agent Construction</a></li>
    <li><a href="/guides/make-call/">Make a Call</a></li>
    <li><a href="/guides/receive-call/">Receive a Call</a></li>
    <li><a href="/guides/send-dtmf/">Send Dtmf</a></li>
    <li><a href="/guides/send-message/">Send Message</a></li>
    <li><a href="/guides/transfer/">Make a Transfer</a></li>
    <li><a class="last" href="/guides/reuse-mediastreams/">Reuse MediaStreams</a></li>
  </ul>
</nav>


  </article>

  <footer class="wrapper">
  <a href="https://www.onsip.com/webrtc-sip-network" id="onsip"></a>
  <nav class="left">
    <ul class="horizontal">
      <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Mailing List</a></li>        
      <li><a href="https://github.com/onsip/sip.js/issues" target="_blank">Report Issues</a></li>
      <li><a href="/license/">License</a></li>
    </ul>
  </nav>
  <nav class="right">
    <ul class="horizontal">
      <li><a href="http://onsip.com/blog" target="_blank">Blog</a></li>
      <li><a href="/aboutus/">About</a></li>
      <li><a href="/faq/">FAQ</a></li>
    </ul>
  </nav>
  <div class="clearfix"></div>
</footer>
<script src="/shared/js/retina.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1008379-16', 'sipjs.com');
  ga('send', 'pageview');
</script>

</body>
</html>
